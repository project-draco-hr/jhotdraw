{
  final DocumentView documentView=getCurrentView();
  if (documentView.isEnabled()) {
    oldFocusOwner=SwingUtilities.getWindowAncestor(documentView.getComponent()).getFocusOwner();
    documentView.setEnabled(false);
    File saveToFile;
    if (!saveAs && documentView.getFile() != null) {
      saveToFile(documentView,documentView.getFile());
    }
 else {
      JFileChooser fileChooser=documentView.getSaveChooser();
      JSheet.showSaveSheet(fileChooser,documentView.getComponent(),new SheetListener(){
        public void optionSelected(        final SheetEvent evt){
          if (evt.getOption() == JFileChooser.APPROVE_OPTION) {
            final File file;
            if (evt.getFileChooser().getFileFilter() instanceof ExtensionFileFilter) {
              file=((ExtensionFileFilter)evt.getFileChooser().getFileFilter()).makeAcceptable(evt.getFileChooser().getSelectedFile());
            }
 else {
              file=evt.getFileChooser().getSelectedFile();
            }
            saveToFile(documentView,file);
          }
 else {
            documentView.setEnabled(true);
            if (oldFocusOwner != null) {
              oldFocusOwner.requestFocus();
            }
          }
        }
      }
);
    }
  }
}
