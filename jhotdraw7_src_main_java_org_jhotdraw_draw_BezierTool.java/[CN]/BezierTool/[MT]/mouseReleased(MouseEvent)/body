{
  if (finishWhenMouseReleased == Boolean.TRUE) {
    if (createdFigure.getNodeCount() > 2) {
      BezierPath fittedPath=Bezier.fitBezierCurve(createdFigure.getBezierPath(),1);
      createdFigure.willChange();
      createdFigure.basicSetBezierPath(fittedPath);
      createdFigure.changed();
      finishCreation(createdFigure);
      createdFigure=null;
      getDrawing().fireUndoableEditHappened(creationEdit);
      finishWhenMouseReleased=null;
      fireToolDone();
      return;
    }
  }
 else   if (finishWhenMouseReleased == null) {
    finishWhenMouseReleased=Boolean.FALSE;
  }
  if (createdFigure.getNodeCount() > nodeCountBeforeDrag + 1) {
    createdFigure.willChange();
    BezierPath fittedPath=new BezierPath();
    for (int i=nodeCountBeforeDrag, n=createdFigure.getNodeCount(); i < n; i++) {
      fittedPath.add(createdFigure.getNode(nodeCountBeforeDrag));
      createdFigure.basicRemoveNode(nodeCountBeforeDrag);
    }
    fittedPath=Bezier.fitBezierCurve(fittedPath,1);
    for (    BezierPath.Node node : fittedPath) {
      createdFigure.basicAddNode(node);
    }
    nodeCountBeforeDrag=createdFigure.getNodeCount();
    createdFigure.changed();
  }
}
