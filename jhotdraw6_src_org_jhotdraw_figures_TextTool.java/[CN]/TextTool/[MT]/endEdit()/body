{
  if (getTypingTarget() != null) {
    if (getFloatingTextField().getText().length() > 0) {
      getTypingTarget().setText(getFloatingTextField().getText());
    }
 else {
      drawing().orphan((Figure)getAddedFigure());
    }
    setUndoActivity(createUndoActivity());
    getUndoActivity().setAffectedFigures(new SingleFigureEnumerator(getAddedFigure()));
    ((TextTool.UndoActivity)getUndoActivity()).setBackupText(getTypingTarget().getText());
    setTypingTarget(null);
    getFloatingTextField().endOverlay();
  }
}
