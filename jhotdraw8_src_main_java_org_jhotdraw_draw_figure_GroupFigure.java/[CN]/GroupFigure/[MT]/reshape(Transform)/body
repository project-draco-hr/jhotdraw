{
  for (  Figure child : getChildren()) {
    Transform p2c=child.getParentToLocal();
    if (p2c.isIdentity()) {
      child.reshape(transform);
    }
 else     if (child instanceof TransformableFigure) {
      child.set(TRANSFORM,Collections.singletonList(child.getLocalToParent()));
      child.set(ROTATE,0.0);
      child.set(TRANSLATE_X,0.0);
      child.set(TRANSLATE_Y,0.0);
      child.set(SCALE_X,1.0);
      child.set(SCALE_Y,1.0);
      if (transform instanceof Translate) {
        Point2D tr=new Point2D(transform.getTx(),transform.getTy());
        tr=Geom.toDeltaTransform(p2c).transform(tr);
        Transform t=new Translate(tr.getX(),tr.getY());
        child.reshape(t);
      }
 else {
        child.reshape(p2c.createConcatenation(transform));
      }
    }
  }
}
