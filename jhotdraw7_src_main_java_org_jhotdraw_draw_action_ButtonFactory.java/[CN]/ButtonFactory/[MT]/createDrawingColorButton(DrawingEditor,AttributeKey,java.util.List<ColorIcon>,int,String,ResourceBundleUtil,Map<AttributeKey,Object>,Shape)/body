{
  final JPopupButton popupButton=new JPopupButton();
  if (defaultAttributes == null) {
    defaultAttributes=new HashMap<AttributeKey,Object>();
  }
  popupButton.setColumnCount(columnCount,false);
  for (  ColorIcon swatch : swatches) {
    DrawingAttributeAction a;
    HashMap<AttributeKey,Object> attributes=new HashMap<AttributeKey,Object>(defaultAttributes);
    attributes.put(attributeKey,swatch.getColor());
    popupButton.add(a=new DrawingAttributeAction(editor,attributes,labels.getString(labelKey),swatch));
    a.putValue(Action.SHORT_DESCRIPTION,swatch.getName());
  }
  DrawingAttributeAction a;
  HashMap<AttributeKey,Object> attributes=new HashMap<AttributeKey,Object>(defaultAttributes);
  attributes.put(attributeKey,null);
  popupButton.add(a=new DrawingAttributeAction(editor,attributes,labels.getString("noColor"),new ColorIcon(null,"---")));
  a.putValue(Action.SHORT_DESCRIPTION,"---");
  ImageIcon chooserIcon=new ImageIcon(ButtonFactory.class.getResource("/org/jhotdraw/draw/action/images/showColorChooser.png"));
  popupButton.add(new DrawingColorChooserAction(editor,attributeKey,"color",chooserIcon,defaultAttributes));
  labels.configureToolBarButton(popupButton,labelKey);
  Icon icon=new DrawingColorIcon(editor,attributeKey,labels.getImageIcon(labelKey,ButtonFactory.class).getImage(),colorShape);
  popupButton.setIcon(icon);
  popupButton.setDisabledIcon(icon);
  popupButton.setFocusable(false);
  editor.addPropertyChangeListener(new DrawingAttributeHandler(editor,popupButton));
  return popupButton;
}
