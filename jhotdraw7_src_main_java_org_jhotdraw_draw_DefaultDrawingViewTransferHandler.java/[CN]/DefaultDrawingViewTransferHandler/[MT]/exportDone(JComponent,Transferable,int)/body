{
  if (DEBUG)   System.out.println(this + ".exportDone " + action+ " move="+ MOVE);
  if (source instanceof DrawingView) {
    final DrawingView view=(DrawingView)source;
    final Drawing drawing=view.getDrawing();
    if (action == MOVE) {
      final LinkedList<DrawingEvent> deletionEvents=new LinkedList<DrawingEvent>();
      final LinkedList<Figure> selectedFigures=new LinkedList<Figure>(view.getSelectedFigures());
      view.clearSelection();
      DrawingListener removeListener=new DrawingListener(){
        public void areaInvalidated(        DrawingEvent e){
        }
        public void figureAdded(        DrawingEvent e){
        }
        public void figureRemoved(        DrawingEvent evt){
          deletionEvents.addFirst(evt);
        }
      }
;
      drawing.addDrawingListener(removeListener);
      drawing.removeAll(selectedFigures);
      drawing.removeDrawingListener(removeListener);
      drawing.removeAll(selectedFigures);
      drawing.fireUndoableEditHappened(new AbstractUndoableEdit(){
        public String getPresentationName(){
          ResourceBundleUtil labels=ResourceBundleUtil.getLAFBundle("org.jhotdraw.draw.Labels");
          return labels.getString("delete");
        }
        public void undo() throws CannotUndoException {
          super.undo();
          view.clearSelection();
          for (          DrawingEvent evt : deletionEvents) {
            drawing.add(evt.getIndex(),evt.getFigure());
          }
          view.addToSelection(selectedFigures);
        }
        public void redo() throws CannotRedoException {
          super.redo();
          for (          DrawingEvent evt : new ReversedList<DrawingEvent>(deletionEvents)) {
            drawing.remove(evt.getFigure());
          }
        }
      }
);
    }
  }
 else {
    super.exportDone(source,data,action);
  }
}
