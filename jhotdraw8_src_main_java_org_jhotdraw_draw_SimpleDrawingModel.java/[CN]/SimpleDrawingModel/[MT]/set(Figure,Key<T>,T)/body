{
  T oldValue=figure.set(key,newValue);
{
    fire(DrawingModelEvent.propertyChanged(this,figure,key,oldValue,newValue));
  }
  if (key instanceof FigureKey) {
    DirtyMask dm=((FigureKey<T>)key).getDirtyMask();
    if (dm.containsOneOf(DirtyBits.NODE)) {
      fire(DrawingModelEvent.nodeChanged(this,figure));
    }
    if (figure instanceof ConnectableFigure) {
      ConnectableFigure connectable=(ConnectableFigure)figure;
      if (dm.containsOneOf(DirtyBits.GEOMETRY,DirtyBits.LAYOUT_BOUNDS)) {
        for (        ConnectionFigure connection : connectable.connections()) {
          fire(DrawingModelEvent.nodeChanged(this,connection));
        }
      }
    }
  }
  fireInvalidated();
}
