{
  ResourceMap labels=getResourceMap();
  updateName(p);
  final JInternalFrame f=new JInternalFrame();
  f.setTitle(labels.getString("MDIWindow.Frame.title",p.getName()));
  f.setDefaultCloseOperation(JInternalFrame.DO_NOTHING_ON_CLOSE);
  f.setClosable(true);
  f.setMaximizable(true);
  f.setResizable(true);
  f.setIconifiable(false);
  Preferences prefs=Preferences.userNodeForPackage(getClass());
  PreferencesUtil.installInternalFramePrefsHandler(prefs,"documentView",f,desktopPane);
  Point loc=f.getLocation();
  boolean moved;
  do {
    moved=false;
    for (Iterator i=getViews().iterator(); i.hasNext(); ) {
      DocumentView aProject=(DocumentView)i.next();
      if (aProject != p && SwingUtilities.getRootPane(aProject.getComponent()).getParent().getLocation().equals(loc)) {
        loc.x+=22;
        loc.y+=22;
        moved=true;
        break;
      }
    }
  }
 while (moved);
  f.setLocation(loc);
  f.addInternalFrameListener(new InternalFrameAdapter(){
    @Override public void internalFrameClosing(    final InternalFrameEvent evt){
      setCurrentView(p);
      getAction(CloseAction.ID).actionPerformed(new ActionEvent(f,ActionEvent.ACTION_PERFORMED,"windowClosing"));
    }
  }
);
  p.addPropertyChangeListener(new PropertyChangeListener(){
    public void propertyChange(    PropertyChangeEvent evt){
      String name=evt.getPropertyName();
      if (name.equals("hasUnsavedChanges")) {
        ((JInternalFrame)f.getRootPane().getParent()).putClientProperty("windowModified",new Boolean(p.isModified()));
      }
 else       if (name.equals("file")) {
        f.setTitle((p.getFile() == null) ? "Unnamed" : p.getFile().getName());
      }
    }
  }
);
  f.addPropertyChangeListener(new PropertyChangeListener(){
    public void propertyChange(    PropertyChangeEvent evt){
      String name=evt.getPropertyName();
      if (name.equals("selected")) {
        if (evt.getNewValue().equals(Boolean.TRUE)) {
          setCurrentView(p);
        }
      }
    }
  }
);
  f.getContentPane().add(p.getComponent());
  f.setVisible(true);
  desktopPane.add(f);
  f.toFront();
  try {
    f.setSelected(true);
  }
 catch (  PropertyVetoException e) {
  }
  p.getComponent().requestFocusInWindow();
}
