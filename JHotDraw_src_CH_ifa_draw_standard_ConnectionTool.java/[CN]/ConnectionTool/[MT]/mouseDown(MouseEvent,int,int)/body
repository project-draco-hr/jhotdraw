{
  int ex=e.getX();
  int ey=e.getY();
  setTargetFigure(findConnectionStart(ex,ey,drawing()));
  if (getTargetFigure() != null) {
    setStartConnector(findConnector(ex,ey,getTargetFigure()));
    if (getStartConnector() != null) {
      Point p=new Point(ex,ey);
      setConnection(createConnection());
      getConnection().startPoint(p.x,p.y);
      getConnection().endPoint(p.x,p.y);
      setAddedFigure(view().add(getConnection()));
    }
  }
 else {
    ConnectionFigure connection=findConnection(ex,ey,drawing());
    if (connection != null) {
      if (!connection.joinSegments(ex,ey)) {
        fSplitPoint=connection.splitSegment(ex,ey);
        fEditedConnection=connection;
      }
 else {
        fEditedConnection=null;
      }
    }
  }
}
