{
  ObservableList<Node> list=p.getChildrenUnmodifiable();
  for (int i=list.size() - 1; i >= 0; i--) {
    Node n=list.get(i);
    Point2D pl=n.parentToLocal(pp);
    if (n.contains(pl)) {
      Figure f=nodeToFigureMap.get(n);
      if (f == null) {
        if (n instanceof Parent) {
          f=findFigureBehind((Parent)n,pl,figureInWay);
        }
      }
      if (f == figureInWay) {
        if (n instanceof Parent) {
          f=findFigure((Parent)n,pl);
        }
 else {
          f=null;
        }
      }
 else {
        if (n instanceof Parent) {
          f=findFigureBehind((Parent)n,pl,figureInWay);
        }
 else {
          f=null;
        }
      }
      return f;
    }
  }
  return null;
}
