{
  ObservableList<Node> list=p.getChildrenUnmodifiable();
  for (int i=list.size() - 1; i >= 0; i--) {
    Node n=list.get(i);
    Figure f1=nodeToFigureMap.get(n);
    if (f1 != null && f1.isSelectable() && f1.isVisible()) {
      Bounds pl=n.parentToLocal(pp);
      if (pl.contains(n.getBoundsInLocal())) {
        Figure f=nodeToFigureMap.get(n);
        if (f != null && f.isSelectable() && !f.isDisabled()) {
          found.add(f);
        }
        if (f == null || !f.isSelectable() || decompose && f.isDecomposable() && !f.isDisabled()) {
          if (n instanceof Parent) {
            findFiguresInsideRecursive((Parent)n,pl,found,decompose);
          }
        }
      }
    }
 else {
      Bounds pl=n.parentToLocal(pp);
      if (n.intersects(pl)) {
        if (n instanceof Parent) {
          findFiguresInsideRecursive((Parent)n,pl,found,decompose);
        }
      }
    }
  }
}
