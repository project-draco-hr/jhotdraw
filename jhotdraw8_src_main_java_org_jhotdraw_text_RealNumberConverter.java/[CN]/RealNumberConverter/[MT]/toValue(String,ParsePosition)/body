{
  if ((str == null || str.length() == 0) && getAllowsNullValue()) {
    return null;
  }
  int end=pp.getIndex();
{
    boolean noMoreSigns=false;
    boolean noMorePoints=false;
    boolean noMoreEs=false;
    Outer:     for (; end < str.length(); end++) {
      char c=str.charAt(end);
switch (c) {
case '+':
case '-':
        if (noMoreSigns) {
          break Outer;
        }
      noMoreSigns=true;
    break;
case '.':
  if (noMorePoints) {
    break Outer;
  }
noMoreSigns=true;
noMorePoints=true;
break;
case '0':
case '1':
case '2':
case '3':
case '4':
case '5':
case '6':
case '7':
case '8':
case '9':
noMoreSigns=true;
break;
case 'e':
case 'E':
if (noMoreEs) {
break Outer;
}
noMoreSigns=false;
noMorePoints=false;
noMoreEs=true;
break;
default :
break Outer;
}
}
}
String text=str.substring(pp.getIndex(),end);
if (unit != null && end < str.length()) {
if (str.substring(end).startsWith(unit)) {
end+=unit.length();
}
}
Class<?> valueClass=getValueClass();
Object value;
if (valueClass != null) {
try {
if (valueClass == Integer.class) {
int v=Integer.parseInt(text);
if (factor != 1.0) {
v=(int)(v / factor);
}
value=v;
}
 else if (valueClass == Long.class) {
long v=Long.parseLong(text);
if (factor != 1.0) {
v=(long)(v / factor);
}
value=v;
}
 else if (valueClass == Float.class) {
float v=Float.parseFloat(text);
if (factor != 1.0) {
v=(float)(v / factor);
}
value=new Float(v);
}
 else if (valueClass == Double.class) {
double v=Double.parseDouble(text);
if (factor != 1.0) {
v=(v / factor);
}
value=new Double(v);
}
 else if (valueClass == Byte.class) {
byte v=Byte.parseByte(text);
if (factor != 1.0) {
v=(byte)(v / factor);
}
value=v;
}
 else if (valueClass == Short.class) {
short v=Short.parseShort(text);
if (factor != 1.0) {
v=(short)(v / factor);
}
value=v;
}
 else {
pp.setErrorIndex(pp.getIndex());
return null;
}
}
 catch (NumberFormatException e) {
pp.setErrorIndex(pp.getIndex());
return null;
}
}
 else {
pp.setErrorIndex(pp.getIndex());
return null;
}
try {
if (!isValidValue(value,true)) {
pp.setErrorIndex(pp.getIndex());
return null;
}
}
 catch (ClassCastException cce) {
pp.setErrorIndex(pp.getIndex());
return null;
}
pp.setIndex(end);
return (Number)value;
}
