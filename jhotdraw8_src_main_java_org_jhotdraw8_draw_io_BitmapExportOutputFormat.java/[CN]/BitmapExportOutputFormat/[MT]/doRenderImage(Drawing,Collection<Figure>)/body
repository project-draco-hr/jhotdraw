{
  Map<Key<?>,Object> hints=new HashMap<>();
  RenderContext.RENDERING_INTENT.put(hints,RenderingIntent.EXPORT);
  RenderContext.DPI.put(hints,dpi);
  javafx.scene.Node node=toNode(drawing,selection,hints);
  SnapshotParameters parameters=new SnapshotParameters();
  double scale=dpi / RenderContext.DPI.getDefaultValue();
  parameters.setTransform(Transform.scale(scale,scale));
  parameters.setFill(Color.TRANSPARENT);
  Bounds bounds=Figure.visualBounds(selection);
  double x=bounds.getMinX() * scale;
  double y=bounds.getMinY() * scale;
  double width=bounds.getWidth() * scale;
  double height=bounds.getHeight() * scale;
  parameters.setViewport(new Rectangle2D(x,y,width,height));
  WritableImage image=node.snapshot(parameters,null);
  return image;
}
