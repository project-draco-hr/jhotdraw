{
  Map<Key<?>,Object> hints=new HashMap<>();
  RenderContext.RENDERING_INTENT.put(hints,RenderingIntent.EXPORT);
  RenderContext.DPI.put(hints,dpi);
  Node node=toNode(drawing,Collections.singleton(drawing),hints);
  Set<String> usedNames=new HashSet<String>();
  for (  Figure slice : slices) {
    if (slice.getId() != null)     usedNames.add(slice.getId());
  }
  IdFactory idFactory=new SimpleIdFactory();
  for (  Figure slice : slices) {
    if (slice.getId() != null) {
      idFactory.putId(slice,slice.getId());
    }
  }
  for (  Figure slice : slices) {
    WritableImage image=renderSlice(slice,node);
    File filename=new File(dir,idFactory.createId(slice,"Slice") + ".png");
    try (OutputStream out=new BufferedOutputStream(new FileOutputStream(filename))){
      writeImage(out,image);
    }
   }
}
