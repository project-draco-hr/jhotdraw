{
  if (typingTarget != null) {
    typingTarget.willChange();
    if (textArea.getText().length() > 0) {
      typingTarget.setText(textArea.getText());
      if (createdFigure != null) {
        getDrawing().fireUndoableEditHappened(creationEdit);
        createdFigure=null;
      }
    }
 else {
      if (createdFigure != null) {
        getDrawing().remove((Figure)getAddedFigure());
      }
 else {
        typingTarget.setText("");
      }
    }
    typingTarget.changed();
    typingTarget=null;
    textArea.endOverlay();
  }
}
