{
  double opacity=OPACITY.get(this);
  opacity=Math.min(Math.max(0d,opacity),1d);
  if (opacity != 0d) {
    if (opacity != 1d) {
      Rectangle2D.Double drawingArea=getDrawingArea();
      Rectangle2D clipBounds=g.getClipBounds();
      if (clipBounds != null) {
        Rectangle2D.intersect(drawingArea,clipBounds,drawingArea);
      }
      if (!drawingArea.isEmpty()) {
        BufferedImage buf=new BufferedImage((int)((2 + drawingArea.width) * g.getTransform().getScaleX()),(int)((2 + drawingArea.height) * g.getTransform().getScaleY()),BufferedImage.TYPE_INT_ARGB);
        Graphics2D gr=buf.createGraphics();
        gr.scale(g.getTransform().getScaleX(),g.getTransform().getScaleY());
        gr.translate((int)-drawingArea.x,(int)-drawingArea.y);
        gr.setRenderingHints(g.getRenderingHints());
        drawFigure(gr);
        gr.dispose();
        Composite savedComposite=g.getComposite();
        g.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_OVER,(float)opacity));
        g.drawImage(buf,(int)drawingArea.x,(int)drawingArea.y,2 + (int)drawingArea.width,2 + (int)drawingArea.height,null);
        g.setComposite(savedComposite);
      }
    }
 else {
      drawFigure(g);
    }
  }
}
