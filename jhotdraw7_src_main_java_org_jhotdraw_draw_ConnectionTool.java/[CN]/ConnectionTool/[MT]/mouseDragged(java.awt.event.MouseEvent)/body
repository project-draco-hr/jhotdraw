{
  updateTarget(e);
  if (createdFigure != null) {
    Point2D.Double endPoint=viewToDrawing(new Point(e.getX(),e.getY()));
    getView().getConstrainer().constrainPoint(endPoint);
    createdFigure.willChange();
    Figure endFigure=getDrawing().findFigureExcept(endPoint,createdFigure);
    if (endConnector != null) {
      Point2D.Double anchor=endConnector.getAnchor();
      Rectangle r=new Rectangle(getView().drawingToView(anchor));
      r.grow(ANCHOR_WIDTH,ANCHOR_WIDTH);
      fireAreaInvalidated(r);
    }
    endConnector=(endFigure == null) ? null : endFigure.findConnector(endPoint,prototype);
    if (endConnector != null && createdFigure.canConnect(startConnector,endConnector)) {
      Point2D.Double anchor=endConnector.getAnchor();
      createdFigure.setEndPoint(anchor);
      Rectangle r=new Rectangle(getView().drawingToView(anchor));
      r.grow(ANCHOR_WIDTH,ANCHOR_WIDTH);
      fireAreaInvalidated(r);
    }
 else {
      createdFigure.setEndPoint(endPoint);
    }
    createdFigure.changed();
  }
}
