{
  NodeWithCost<V,E> node=new NodeWithCost<>(start,0.0,null,null);
  PriorityQueue<NodeWithCost<V,E>> frontier=new PriorityQueue<>();
  frontier.add(node);
  Set<V> explored=new HashSet<>(graph.getVertexCount());
  Map<V,NodeWithCost<V,E>> frontierMap=new HashMap<>(graph.getVertexCount());
  while (true) {
    if (frontier.isEmpty()) {
      return null;
    }
    node=frontier.poll();
    final V vertex=node.vertex;
    frontierMap.remove(vertex);
    if (vertex == goal) {
      break;
    }
    explored.add(node.getVertex());
    for (int i=0, count=graph.getNextCount(vertex); i < count; i++) {
      V next=graph.getNext(vertex,i);
      final E edge=graph.getEdge(vertex,i);
      double cost=node.cost + costf.applyAsDouble(edge);
      NodeWithCost<V,E> nwc=new NodeWithCost<>(next,cost,node,edge);
      boolean isInFrontier=frontierMap.containsKey(next);
      if (!explored.contains(next) && !isInFrontier) {
        frontier.add(nwc);
        frontierMap.put(next,nwc);
      }
 else       if (isInFrontier) {
        NodeWithCost<V,E> nwcInFrontier=frontierMap.put(next,nwc);
        if (nwcInFrontier.cost > cost) {
          frontier.remove(nwcInFrontier);
          frontier.add(nwc);
        }
      }
    }
  }
  return node;
}
