{
  if (!p.isShowing()) {
    p.setShowing(true);
    final JInternalFrame f=new JInternalFrame();
    f.setDefaultCloseOperation(JInternalFrame.DO_NOTHING_ON_CLOSE);
    f.setClosable(getModel().getAction(CloseFileAction.ID) != null);
    f.setMaximizable(true);
    f.setResizable(true);
    f.setIconifiable(false);
    f.setPreferredSize(new Dimension(400,400));
    updateViewTitle(p,f);
    PreferencesUtil.installInternalFramePrefsHandler(prefs,"view",f,desktopPane);
    Point loc=new Point(desktopPane.getInsets().left,desktopPane.getInsets().top);
    boolean moved;
    do {
      moved=false;
      for (Iterator i=views().iterator(); i.hasNext(); ) {
        View aView=(View)i.next();
        if (aView != p && aView.isShowing() && SwingUtilities.getRootPane(aView.getComponent()).getParent().getLocation().equals(loc)) {
          Point offset=SwingUtilities.convertPoint(SwingUtilities.getRootPane(aView.getComponent()),0,0,SwingUtilities.getRootPane(aView.getComponent()).getParent());
          loc.x+=Math.max(offset.x,offset.y);
          loc.y+=Math.max(offset.x,offset.y);
          moved=true;
          break;
        }
      }
    }
 while (moved);
    f.setLocation(loc);
    f.addInternalFrameListener(new InternalFrameAdapter(){
      @Override public void internalFrameClosing(      final InternalFrameEvent evt){
        getModel().getAction(CloseFileAction.ID).actionPerformed(new ActionEvent(f,ActionEvent.ACTION_PERFORMED,"windowClosing"));
      }
      @Override public void internalFrameClosed(      final InternalFrameEvent evt){
        if (p == getActiveView()) {
          setActiveView(null);
        }
        p.stop();
      }
    }
);
    p.addPropertyChangeListener(new PropertyChangeListener(){
      public void propertyChange(      PropertyChangeEvent evt){
        String name=evt.getPropertyName();
        if (name == View.HAS_UNSAVED_CHANGES_PROPERTY || name == View.URI_PROPERTY) {
          updateViewTitle(p,f);
        }
      }
    }
);
    f.addPropertyChangeListener(new PropertyChangeListener(){
      public void propertyChange(      PropertyChangeEvent evt){
        String name=evt.getPropertyName();
        if (name.equals("selected")) {
          if (evt.getNewValue().equals(Boolean.TRUE)) {
            setActiveView(p);
          }
        }
      }
    }
);
    f.getContentPane().add(p.getComponent());
    f.setVisible(true);
    desktopPane.add(f);
    if (desktopPane.getComponentCount() == 1) {
      try {
        f.setMaximum(true);
      }
 catch (      PropertyVetoException ex) {
      }
    }
    f.toFront();
    try {
      f.setSelected(true);
    }
 catch (    PropertyVetoException e) {
    }
    p.getComponent().requestFocusInWindow();
    p.start();
  }
}
