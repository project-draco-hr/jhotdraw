{
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  byte[] buf=new byte[512];
  int bytesRead;
  while ((bytesRead=in.read(buf)) > 0) {
    baos.write(buf,0,bytesRead);
  }
  BufferedImage img;
  try {
    img=ImageIO.read(new ByteArrayInputStream(baos.toByteArray()));
  }
 catch (  Throwable t) {
    img=null;
  }
  if (img == null) {
    ResourceBundleUtil labels=ResourceBundleUtil.getLAFBundle("org.jhotdraw.draw.Labels");
    throw new IOException(labels.getFormatted("failedToLoadImage",in.toString()));
  }
  imageData=baos.toByteArray();
  bufferedImage=img;
}
