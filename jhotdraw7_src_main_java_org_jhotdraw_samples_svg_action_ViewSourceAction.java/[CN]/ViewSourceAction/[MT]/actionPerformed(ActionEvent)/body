{
  SVGView p=(SVGView)getActiveView();
  SVGOutputFormat format=new SVGOutputFormat();
  format.setPrettyPrint(true);
  ByteArrayOutputStream buf=new ByteArrayOutputStream();
  try {
    format.write(buf,p.getDrawing());
    String source=buf.toString("UTF-8");
    final JDialog dialog=new JDialog((Frame)SwingUtilities.getWindowAncestor(p.getComponent()));
    dialog.setTitle(p.getTitle());
    dialog.setResizable(true);
    dialog.setDefaultCloseOperation(JDialog.DISPOSE_ON_CLOSE);
    JTextArea ta=new JTextArea(source);
    ta.setWrapStyleWord(true);
    ta.setLineWrap(true);
    JScrollPane sp=new JScrollPane(ta);
    dialog.getContentPane().add(sp);
    dialog.setSize(400,400);
    dialog.setLocationByPlatform(true);
    Preferences prefs=Preferences.userNodeForPackage(getClass());
    PreferencesUtil.installFramePrefsHandler(prefs,"viewSource",dialog);
    dialog.addWindowListener(new WindowAdapter(){
      @Override public void windowClosed(      WindowEvent evt){
        getApplication().removeWindow(dialog);
      }
    }
);
    getApplication().addWindow(dialog,getActiveView());
    dialog.setVisible(true);
  }
 catch (  IOException ex) {
    ex.printStackTrace();
  }
}
