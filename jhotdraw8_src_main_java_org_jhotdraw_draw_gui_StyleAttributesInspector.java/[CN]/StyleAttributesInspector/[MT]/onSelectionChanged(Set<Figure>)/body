{
  if (!updateContentsCheckBox.isSelected()) {
    return;
  }
  if (drawingView == null || drawingView.getDrawing() == null) {
    textArea.setText("");
    return;
  }
  if (newValue.isEmpty()) {
    newValue=new HashSet<Figure>();
    newValue.add(drawingView.getDrawing());
  }
  Drawing d=drawingView.getDrawing();
  StyleManager<Figure> styleManager=d.getStyleManager();
  SelectorModel<Figure> selectorModel=styleManager.getSelectorModel();
  String id=null;
  String type=null;
  Set<String> styleClasses=new TreeSet<>();
  Map<String,String> attr=new TreeMap<>();
  boolean first=true;
  for (  Figure f : newValue) {
    selectorModel.getAttributeNames(f);
    if (first) {
      first=false;
      id=selectorModel.getId(f);
      type=selectorModel.getType(f);
      styleClasses.addAll(selectorModel.getStyleClasses(f));
      for (      String name : selectorModel.getAttributeNames(f)) {
        attr.put(name,selectorModel.getAttributeValue(f,name));
      }
    }
 else {
      attr.keySet().retainAll(selectorModel.getAttributeNames(f));
      id=null;
      type=selectorModel.getType(f).equals(type) ? type : null;
      styleClasses.retainAll(selectorModel.getStyleClasses(f));
      for (      String name : attr.keySet()) {
        String oldAttrValue=attr.get(name);
        if (oldAttrValue != null) {
          String newAttrValue=selectorModel.getAttributeValue(f,name);
          if (!oldAttrValue.equals(newAttrValue)) {
            attr.put(name,"/* multiple values */");
          }
        }
      }
    }
  }
  StringBuilder buf=new StringBuilder();
  if (type != null) {
    buf.append(type);
  }
  if (id != null) {
    buf.append('#').append(id);
  }
  for (  String clazz : styleClasses) {
    buf.append('.').append(clazz);
  }
  buf.append(":selected {");
  for (  Map.Entry<String,String> a : attr.entrySet()) {
    buf.append("\n  ").append(a.getKey()).append(": ");
    buf.append(a.getValue());
    buf.append(";");
  }
  buf.append("\n}");
  textArea.setText(buf.toString());
}
