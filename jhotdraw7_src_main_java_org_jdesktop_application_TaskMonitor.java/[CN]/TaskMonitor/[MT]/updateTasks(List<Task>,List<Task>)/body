{
  boolean tasksChanged=false;
  List<Task> oldTaskQueue=copyTaskQueue();
  for (  Task oldTask : oldTasks) {
    if (!(newTasks.contains(oldTask))) {
      if (taskQueue.remove(oldTask)) {
        tasksChanged=true;
      }
    }
  }
  for (  Task newTask : newTasks) {
    if (!(taskQueue.contains(newTask))) {
      taskQueue.addLast(newTask);
      tasksChanged=true;
    }
  }
  Iterator<Task> tasks=taskQueue.iterator();
  while (tasks.hasNext()) {
    Task task=tasks.next();
    if (task.isDone()) {
      tasks.remove();
      tasksChanged=true;
    }
  }
  if (tasksChanged) {
    List<Task> newTaskQueue=copyTaskQueue();
    firePropertyChange("tasks",oldTaskQueue,newTaskQueue);
  }
  if (autoUpdateForegroundTask && (getForegroundTask() == null)) {
    setForegroundTask(taskQueue.isEmpty() ? null : taskQueue.getLast());
  }
}
