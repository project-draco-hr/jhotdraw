{
  if (createdFigure != null) {
    Rectangle2D.Double bounds=createdFigure.getBounds();
    if (bounds.width == 0 && bounds.height == 0) {
      getDrawing().remove(createdFigure);
    }
 else {
      if (Math.abs(anchor.x - evt.getX()) < minimalSizeTreshold.width && Math.abs(anchor.y - evt.getY()) < minimalSizeTreshold.height) {
        createdFigure.basicSetBounds(constrainPoint(new Point(anchor.x,anchor.y)),constrainPoint(new Point(anchor.x + (int)Math.max(bounds.width,minimalSize.width),anchor.y + (int)Math.max(bounds.height,minimalSize.height))));
      }
      getView().addToSelection(createdFigure);
    }
    if (createdFigure instanceof CompositeFigure) {
      ((CompositeFigure)createdFigure).layout();
    }
    getDrawing().fireUndoableEditHappened(creationEdit);
    creationFinished(createdFigure);
    createdFigure=null;
  }
}
