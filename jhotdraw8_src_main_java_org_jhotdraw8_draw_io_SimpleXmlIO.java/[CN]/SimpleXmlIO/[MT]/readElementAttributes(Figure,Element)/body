{
  NamedNodeMap attrs=elem.getAttributes();
  for (int i=0, n=attrs.getLength(); i < n; i++) {
    Attr attr=(Attr)attrs.item(i);
    if (attr.getNamespaceURI() != null && !attr.getNamespaceURI().equals(namespaceURI)) {
      continue;
    }
    @SuppressWarnings("unchecked") MapAccessor<Object> key=(MapAccessor<Object>)figureFactory.nameToKey(figure,attr.getLocalName());
    if (key != null && figureFactory.figureAttributeKeys(figure).contains(key)) {
      Object value=null;
      if (Figure.class.isAssignableFrom(key.getValueType())) {
        value=getFigure(attr.getValue());
      }
 else {
        value=figureFactory.stringToValue(key,attr.getValue());
      }
      if (value instanceof URI) {
        value=externalToInternal(figure.getDrawing(),(URI)value);
      }
      figure.set(key,value);
    }
  }
}
