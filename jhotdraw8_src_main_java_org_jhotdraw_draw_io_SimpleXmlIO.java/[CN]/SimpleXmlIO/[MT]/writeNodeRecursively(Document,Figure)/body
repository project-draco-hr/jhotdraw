{
  try {
    String elementName=factory.figureToName(figure);
    if (elementName == null) {
      return null;
    }
    Element elem=createElement(doc,elementName);
    writeElementAttributes(elem,figure);
    writeElementNodeList(doc,elem,figure);
    for (    Figure child : figure.childrenProperty()) {
      if (factory.figureToName(child) != null) {
        elem.appendChild(doc.createTextNode("\n"));
        Node childNode=writeNodeRecursively(doc,child);
        if (childNode != null) {
          elem.appendChild(childNode);
        }
      }
    }
    if (!figure.childrenProperty().isEmpty()) {
      elem.appendChild(doc.createTextNode("\n"));
    }
    return elem;
  }
 catch (  IOException e) {
    throw new IOException("Error writing figure " + figure,e);
  }
}
