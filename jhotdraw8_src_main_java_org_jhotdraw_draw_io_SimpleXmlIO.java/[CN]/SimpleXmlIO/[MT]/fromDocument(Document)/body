{
  ids.reset();
  figureElements.clear();
  Drawing external=null;
  NodeList list=doc.getChildNodes();
  for (int i=0; i < list.getLength(); i++) {
    Figure f=readNodeRecursively(list.item(i));
    if (f instanceof Drawing) {
      external=(Drawing)f;
      break;
    }
  }
  try {
    for (    Element elem : figureElements) {
      readElementAttributes(elem);
    }
  }
  finally {
    figureElements.clear();
  }
  if (external != null) {
    return factory.fromExternalDrawing(external);
  }
 else {
    throw new IOException(namespaceURI == null ? "document does not contain a drawing" : "document does not contain a drawing in namespace " + namespaceURI);
  }
}
