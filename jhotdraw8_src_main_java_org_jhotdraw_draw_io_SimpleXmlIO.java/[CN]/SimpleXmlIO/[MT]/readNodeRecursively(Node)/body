{
  if (node instanceof Element) {
    Element elem=(Element)node;
    if (namespaceURI != null) {
      if (!namespaceURI.equals(elem.getNamespaceURI())) {
        return null;
      }
    }
    Figure figure=factory.nameToFigure(elem.getLocalName());
    if (figure == null) {
      return null;
    }
    figureElements.add(elem);
    String id=getAttribute(elem,"id");
    if (id != null) {
      ids.putId(figure,id);
    }
    NodeList list=elem.getChildNodes();
    for (int i=0; i < list.getLength(); i++) {
      Figure child=readNodeRecursively(list.item(i));
      if (child instanceof Figure) {
        figure.add(child);
      }
    }
    return figure;
  }
  return null;
}
