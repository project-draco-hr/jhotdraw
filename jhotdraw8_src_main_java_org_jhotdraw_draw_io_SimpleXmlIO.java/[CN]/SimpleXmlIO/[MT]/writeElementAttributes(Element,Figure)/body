{
  setAttribute(elem,factory.getObjectIdAttribute(),factory.createId(figure));
  for (  MapAccessor<?> k : factory.figureAttributeKeys(figure)) {
    if (k.isTransient()) {
      continue;
    }
    @SuppressWarnings("unchecked") MapAccessor<Object> key=(MapAccessor<Object>)k;
    Object value=figure.get(key);
    if (value instanceof URI) {
      value=internalToExternal(figure.getDrawing(),(URI)value);
    }
    if (!factory.isDefaultValue(key,value)) {
      if (Figure.class.isAssignableFrom(key.getValueType())) {
        setAttribute(elem,factory.keyToName(figure,key),factory.createId(value));
      }
 else {
        setAttribute(elem,factory.keyToName(figure,key),factory.valueToString(key,value));
      }
    }
  }
}
