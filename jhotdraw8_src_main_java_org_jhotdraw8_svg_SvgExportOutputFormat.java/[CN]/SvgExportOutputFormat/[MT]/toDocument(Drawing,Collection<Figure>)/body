{
  SimpleDrawingRenderer r=new SimpleDrawingRenderer();
  r.set(RenderContext.RENDERING_INTENT,RenderingIntent.EXPORT);
  LinkedList<Node> nodes=new LinkedList<>();
  for (  Figure f : external.preorderIterable()) {
    if (selection.contains(f)) {
      nodes.add(r.render(f));
    }
  }
  Node drawingNode;
  if (nodes.size() == 1) {
    drawingNode=nodes.getFirst();
  }
 else {
    drawingNode=new Group(nodes);
  }
  Document doc=toDocument(drawingNode);
  writeDrawingElementAttributes(doc.getDocumentElement(),external);
  return doc;
}
