{
  if (getDrawing() == null) {
    translate.x=translate.y=0;
    return;
  }
  Point2D.Double oldTranslate=(Point2D.Double)translate.clone();
  int width=getWidth();
  int height=getHeight();
  Insets insets=getInsets();
  Rectangle2D.Double r=getDrawingArea();
  Double cw=getDrawing().get(CANVAS_WIDTH);
  Double ch=getDrawing().get(CANVAS_HEIGHT);
  if (cw == null || ch == null) {
    translate.x=Math.min(0,r.x);
    translate.y=Math.min(0,r.y);
  }
 else {
    Dimension preferred=getPreferredSize();
    if (cw != null && ch != null) {
      if (cw * scaleFactor < width) {
        translate.x=(width / scaleFactor - cw) / -2d;
      }
      if (ch * scaleFactor < height) {
        translate.y=(height / scaleFactor - ch) / -2d;
      }
    }
    if (r.y - translate.y < insets.top / scaleFactor) {
      translate.y=r.y;
    }
 else     if (r.y - translate.y + r.height > (height - insets.bottom) / scaleFactor) {
      translate.y=r.y + r.height - (height - insets.bottom) / scaleFactor;
    }
    if (r.x - translate.x < insets.left / scaleFactor) {
      translate.x=r.x;
    }
 else     if (r.x - translate.x + r.width > (width - insets.right) / scaleFactor) {
      translate.x=r.x + r.width - (width - insets.right) / scaleFactor;
    }
  }
  if (!oldTranslate.equals(translate)) {
    fireViewTransformChanged();
    repaint();
  }
}
