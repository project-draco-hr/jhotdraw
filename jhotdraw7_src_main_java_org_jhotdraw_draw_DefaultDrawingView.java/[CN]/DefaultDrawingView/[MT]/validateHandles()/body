{
  if (!handlesAreValid) {
    handlesAreValid=true;
    Rectangle invalidatedArea=null;
    int level=detailLevel;
    do {
      for (      Figure figure : getSelectedFigures()) {
        for (        Handle handle : figure.createHandles(level)) {
          handle.setView(this);
          selectionHandles.add(handle);
          handle.addHandleListener(this);
          if (invalidatedArea == null) {
            invalidatedArea=handle.getBounds();
          }
 else {
            invalidatedArea.add(handle.getBounds());
          }
        }
      }
    }
 while (level-- > 0 && selectionHandles.size() == 0);
    detailLevel=level + 1;
    if (invalidatedArea != null) {
      repaint(invalidatedArea);
    }
  }
}
