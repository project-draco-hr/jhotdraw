{
  super.mouseReleased(evt);
  isDragging=false;
  int x=evt.getX();
  int y=evt.getY();
  updateCursor(editor.findView((Container)evt.getSource()),new Point(evt.getX(),evt.getY()));
  Point2D.Double p=getView().getConstrainer().constrainPoint(getView().viewToDrawing(new Point(x,y)));
  Collection<Figure> draggedFigures=new LinkedList(getView().getSelectedFigures());
  Figure dropTarget=getDrawing().findFigureExcept(p,draggedFigures);
  if (dropTarget != null) {
    boolean snapBack=dropTarget.handleDrop(p,draggedFigures,getView());
    if (snapBack) {
      AffineTransform tx=new AffineTransform();
      tx.translate(anchorPoint.x - oldPoint.x,anchorPoint.y - oldPoint.y);
      for (      Figure f : draggedFigures) {
        f.willChange();
        f.basicTransform(tx);
        f.changed();
      }
    }
 else {
      AffineTransform tx=new AffineTransform();
      tx.translate(-anchorPoint.x + oldPoint.x,-anchorPoint.y + oldPoint.y);
      if (!tx.isIdentity()) {
        getDrawing().fireUndoableEditHappened(new TransformEdit(draggedFigures,tx));
      }
    }
  }
 else {
    AffineTransform tx=new AffineTransform();
    tx.translate(-anchorPoint.x + oldPoint.x,-anchorPoint.y + oldPoint.y);
    if (!tx.isIdentity()) {
      getDrawing().fireUndoableEditHappened(new TransformEdit(draggedFigures,tx));
    }
  }
  fireToolDone();
}
