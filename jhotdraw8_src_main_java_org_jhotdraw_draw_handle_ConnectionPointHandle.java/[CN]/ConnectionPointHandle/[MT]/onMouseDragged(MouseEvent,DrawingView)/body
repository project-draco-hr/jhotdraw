{
  double newX=event.getX();
  double newY=event.getY();
  Figure f=getFigure();
  Transform t=f.getDrawingToLocal().createConcatenation(dv.getViewToDrawing());
  Point2D delta=t.deltaTransform(newX - startX,newY - startY);
  Point2D p=startPoint;
  unconstrainedPoint=new Point2D(p.getX() + delta.getX(),p.getY() + delta.getY());
  Point2D newPoint=dv.getConstrainer().constrainPoint(f,unconstrainedPoint);
  Connector newConnector=null;
  Figure newFigure=null;
  if (!event.isAltDown() && !event.isControlDown()) {
    List<Figure> list=dv.findFigures(newPoint,true);
    for (    Figure ff : list) {
      newConnector=ff.findConnector(newPoint,f);
      if (newConnector != null) {
        newFigure=ff;
        break;
      }
    }
  }
  DrawingModel dm=dv.getDrawingModel();
  dm.set(f,pointKey,newPoint);
  dm.set(f,figureKey,newFigure);
  dm.set(f,connectorKey,newConnector);
  dm.layout(f);
}
