{
  if (recreateHandles) {
    for (    Map.Entry<Figure,List<Handle>> entry : handles.entrySet()) {
      for (      Handle h : entry.getValue()) {
        h.dispose();
      }
    }
    nodeToHandleMap.clear();
    handles.clear();
    handlesPane.getChildren().clear();
    dirtyHandles.clear();
    createHandles(handles);
    recreateHandles=false;
  }
  for (  Map.Entry<Figure,List<Handle>> entry : handles.entrySet()) {
    for (    Handle handle : entry.getValue()) {
      Node n=handle.getNode();
      if (nodeToHandleMap.put(n,handle) == null) {
        handlesPane.getChildren().add(n);
      }
      handle.updateNode(this);
    }
  }
}
